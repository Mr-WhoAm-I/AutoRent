<Page x:Class="CarRental.UI.Views.Pages.MaintenancePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:hc="https://handyorg.github.io/handycontrol"
      Title="Обслуживание" FontFamily="Segoe UI" Loaded="Page_Loaded">

    <Grid Margin="0,0,10,0">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <TextBlock Text="Техническое обслуживание" FontSize="26" FontWeight="Bold" Foreground="#333" Margin="0,0,0,20"/>

        <Grid Grid.Row="1" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="350"/>
                <ColumnDefinition Width="20"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <hc:SearchBar x:Name="SearchBox" Height="45" FontSize="14"
                          Style="{StaticResource SearchBarPlus}"
                          hc:InfoElement.Placeholder="Поиск (Авто, Тип, Механик)..."
                          hc:InfoElement.ShowClearButton="True"
                          TextChanged="Search_TextChanged"/>

            <CheckBox x:Name="ChkMyTasks" Grid.Column="2" Content="Только мои задачи" 
                      IsChecked="True" VerticalAlignment="Center" Cursor="Hand"
                      Checked="Filter_Changed" Unchecked="Filter_Changed"
                      Style="{StaticResource FilterCheckBoxStyle}"/>

            <Button Grid.Column="4" Content="+ Создать наряд" 
                    Style="{StaticResource ButtonPrimary}" Background="{StaticResource GreenGradientBrush}" 
                    BorderThickness="0" Height="45" Padding="20,0"
                    Click="Add_Click"/>
        </Grid>

        <TabControl x:Name="MainTabs" Grid.Row="2" Style="{StaticResource TabControlInLine}" SelectionChanged="Tab_SelectionChanged">
            <TabControl.Resources>
                <Style x:Key="TabControlInLine" TargetType="TabControl">
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="TabControl">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <StackPanel Orientation="Horizontal" IsItemsHost="True" Margin="0,0,0,15"/>
                                    <ContentPresenter ContentSource="SelectedContent" Grid.Row="1"/>
                                </Grid>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </TabControl.Resources>

            <TabItem Header="В работе">
                <DataGrid x:Name="ActiveGrid" Style="{StaticResource ModernDataGrid}" CanUserSortColumns="True"
                          MouseDoubleClick="Grid_MouseDoubleClick">
                    <DataGrid.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Редактировать / Завершить" Click="Edit_Click"/>
                            <MenuItem Header="Удалить запись" Click="Delete_Click" Foreground="Red"/>
                        </ContextMenu>
                    </DataGrid.ContextMenu>
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Начало" Binding="{Binding DateStart, StringFormat=dd.MM.yyyy}" Width="80" FontWeight="Bold"/>

                        <DataGridTemplateColumn Header="Автомобиль" Width="180" SortMemberPath="CarName">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel VerticalAlignment="Center">
                                        <TextBlock Text="{Binding CarName}" FontWeight="Bold" Foreground="#333"/>
                                        <Border Background="#F5F5F5" CornerRadius="3" Padding="4,0" HorizontalAlignment="Left" Margin="0,2,0,0">
                                            <TextBlock Text="{Binding PlateNumber}" Foreground="#555" FontSize="11"/>
                                        </Border>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <DataGridTextColumn Header="Тип работ" Binding="{Binding ServiceType}" Width="180" FontWeight="SemiBold"/>

                        <DataGridTemplateColumn Header="Ответственный" Width="140" SortMemberPath="MechanicName">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel VerticalAlignment="Center">
                                        <TextBlock Text="{Binding MechanicName}"/>
                                        <TextBlock Text="{Binding MechanicPosition}" FontSize="10" Foreground="Gray"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <DataGridTextColumn Header="Описание" Binding="{Binding Description}" Width="*" ElementStyle="{StaticResource WrapTextCell}"/>

                        <DataGridTemplateColumn Width="100">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Content="Завершить" Click="Finish_Click"
                                            Style="{StaticResource ButtonDashed}" 
                                            FontSize="11" Height="28" 
                                            Foreground="{StaticResource GreenAccentBrush}" BorderBrush="{StaticResource GreenAccentBrush}"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>

            <TabItem Header="История">
                <DataGrid x:Name="HistoryGrid" Style="{StaticResource ModernDataGrid}" IsReadOnly="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Период" Binding="{Binding Period}" Width="80"/>
                        <DataGridTextColumn Header="Автомобиль" Binding="{Binding CarName}" Width="180"/>
                        <DataGridTextColumn Header="Тип работ" Binding="{Binding ServiceType}" Width="150"/>
                        <DataGridTextColumn Header="Механик" Binding="{Binding MechanicName}" Width="130"/>
                        <DataGridTextColumn Header="Стоимость" Binding="{Binding Cost, StringFormat={}{0:N2} BYN}" Width="100" FontWeight="Bold"/>
                        <DataGridTextColumn Header="Описание" Binding="{Binding Description}" Width="*" ElementStyle="{StaticResource WrapTextCell}"/>
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>
        </TabControl>
    </Grid>
</Page>