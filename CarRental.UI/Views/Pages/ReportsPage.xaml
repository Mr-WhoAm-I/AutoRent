<Page x:Class="CarRental.UI.Views.Pages.ReportsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:hc="https://handyorg.github.io/handycontrol"
      Title="Отчеты" FontFamily="Segoe UI" Loaded="Page_Loaded">

    <Grid Margin="0,0,10,0">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Text="Мастер отчетов" FontSize="26" FontWeight="Bold" Foreground="#333" Margin="0,0,0,20"/>

        <Border Grid.Row="1" Background="White" CornerRadius="10" BorderBrush="#EEE" BorderThickness="1" Padding="15" Margin="0,0,0,20">
            <StackPanel>
                <TextBlock Text="Параметры" FontWeight="Bold" Margin="0,0,0,10"/>

                <WrapPanel Orientation="Horizontal">
                    <ComboBox x:Name="ComboType" Width="250" Height="40" Margin="0,0,20,10"
                              Style="{StaticResource FloatingHintComboBox}" Tag="Выберите отчет"
                              SelectionChanged="ComboType_SelectionChanged">
                        <ComboBoxItem Content="1. Справочник клиентов" Tag="Clients"/>
                        <ComboBoxItem Content="2. Эффективность автопарка" Tag="Cars"/>
                        <ComboBoxItem Content="3. Финансовый отчет (Детализация)" Tag="Income"/>
                    </ComboBox>

                    <StackPanel x:Name="PanelDates" Orientation="Horizontal" Visibility="Collapsed" Margin="0,0,20,10">
                        <hc:DatePicker x:Name="DateStart" Width="140" Height="40" hc:InfoElement.Placeholder="С" Margin="0,0,10,0"/>
                        <hc:DatePicker x:Name="DateEnd" Width="140" Height="40" hc:InfoElement.Placeholder="По"/>
                    </StackPanel>

                    <hc:CheckComboBox x:Name="ComboClass" Width="250" Height="40" Visibility="Collapsed"
                                      Tag="Классы авто (Пусто = Все)"
                                      DisplayMemberPath="Name" Margin="0,0,20,10"/>

                    <Button Content="Сформировать" Click="Generate_Click"
                            Style="{StaticResource ButtonPrimary}" Background="{StaticResource GreenGradientBrush}"
                            BorderThickness="0" Height="40" Width="140"/>
                </WrapPanel>
            </StackPanel>
        </Border>

        <Grid Grid.Row="2" Margin="0,0,0,20">
            <DataGrid x:Name="GridClients" Style="{StaticResource ModernDataGrid}" Visibility="Collapsed">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ФИО" Binding="{Binding FullName}" Width="250"/>
                    <DataGridTextColumn Header="Телефон" Binding="{Binding Phone}" Width="150"/>
                    <DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="200"/>
                    <DataGridTextColumn Header="Всего аренд" Binding="{Binding RentalsCount}" Width="120"/>
                </DataGrid.Columns>
            </DataGrid>

            <DataGrid x:Name="GridCars" Style="{StaticResource ModernDataGrid}" Visibility="Collapsed">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Автомобиль" Binding="{Binding CarName}" Width="180" FontWeight="Bold"/>
                    <DataGridTextColumn Header="Гос. номер" Binding="{Binding PlateNumber}" Width="100"/>
                    <DataGridTextColumn Header="Класс" Binding="{Binding ClassName}" Width="100"/>
                    <DataGridTextColumn Header="Выручка" Binding="{Binding Revenue, StringFormat={}{0:N2}}" Width="100" Foreground="Green"/>
                    <DataGridTextColumn Header="Расходы" Binding="{Binding Expenses, StringFormat={}{0:N2}}" Width="100" Foreground="Red"/>
                    <DataGridTextColumn Header="Прибыль" Binding="{Binding Profit, StringFormat={}{0:N2}}" Width="100"/>
                    <DataGridTextColumn Header="Индекс" Binding="{Binding ProfitIndex}" Width="80"/>
                    <DataGridTextColumn Header="Статус" Binding="{Binding Status}" Width="100"/>
                </DataGrid.Columns>
            </DataGrid>

            <DataGrid x:Name="GridIncome" Style="{StaticResource ModernDataGrid}" Visibility="Collapsed">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Дата" Binding="{Binding Date, StringFormat=dd.MM.yyyy}" Width="100"/>
                    <DataGridTextColumn Header="Автомобиль" Binding="{Binding CarInfo}" Width="250"/>
                    <DataGridTextColumn Header="Тип" Binding="{Binding Type}" Width="150"/>
                    <DataGridTextColumn Header="Сумма" Binding="{Binding Amount, StringFormat={}{0:N2} BYN}" Width="*" FontWeight="Bold" Foreground="#00C853"/>
                </DataGrid.Columns>
            </DataGrid>

            <TextBlock x:Name="TxtHint" Text="Выберите параметры..." VerticalAlignment="Center" HorizontalAlignment="Center" Foreground="Gray"/>
        </Grid>

        <Grid Grid.Row="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel x:Name="PanelTotal" Orientation="Horizontal" VerticalAlignment="Center" Visibility="Collapsed">
                <TextBlock Text="ИТОГО (Предварительно):" FontWeight="Bold" FontSize="16" Margin="0,0,10,0"/>
                <TextBlock x:Name="TxtTotalSum" Text="0.00 BYN" FontWeight="Bold" FontSize="16" Foreground="{StaticResource GreenAccentBrush}"/>
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <Button Content="Экспорт в PDF" Click="Print_Click" Style="{StaticResource ButtonDashed}" Height="45" Width="150" Margin="0,0,10,0"/>
                <Button Content="Экспорт в Excel" Click="ExportExcel_Click" Style="{StaticResource ButtonPrimary}" Height="45" Width="150"/>
            </StackPanel>
        </Grid>
    </Grid>
</Page>